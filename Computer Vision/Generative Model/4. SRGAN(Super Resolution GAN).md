# **Computer Vision - Generative Model**
# **4. SRGAN (Super Resolution GAN)** 




ì¶œì²˜: https://wikidocs.net/146367




![](./img/4-1.png)

- **Image Super Resolution(SR)**: ì €í•´ìƒë„(Low Resolution) ì´ë¯¸ì§€ë¥¼ ê³ í•´ìƒë„ ì´ë¯¸ì§€(High Resolution) ì´ë¯¸ì§€ë¡œ ë³€í™˜ì‹œí‚¤ëŠ” ë¬¸ì œ


- ì¼ë°˜ì ìœ¼ë¡œ SIngle Image Super Resolution ë¬¸ì œë¥¼ ì ‘ê·¼í•˜ëŠ” ë°©ì‹ì€ í¬ê²Œ 3ê°€ì§€

1. Interpolation-based method
2. Reconstruction-based method
3. (Deep) Learning-based method

- Deep Learning-based methodì¸ SRGANì„ ì¤‘ì ì ìœ¼ë¡œ í™•ì¸í•  ì˜ˆì •

</br>
</br>

# 4-1. Introduction

- Super Resolutionì˜ (Deep) Learning-based methodì˜ ì´ˆê¸° ëª¨ë¸ë¶€í„° GANì„ ì‚¬ìš©í•œ ê²ƒì€ ì•„ë‹ˆì—ˆë‹¤.
- ìµœì´ˆë¡œ deep learningì„ super resolutionì— ì ìš©í•œ SRCNN ì´í›„ ë” ë¹ ë¥´ê³ , ë” ê¹Šì€ CNN ëª¨ë¸ë“¤ì´ ì œì‹œë˜ì—ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  í•´ê²°ë˜ì§€ ì•Šì€ ë¬¸ì œì ì´ ìˆì—ˆë‹¤.

![](./img/4-2.png)

- ê¸°ì¡´ SR ëª¨ë¸ ì¤‘ í•˜ë‚˜ì¸ SRResNetì´ ìƒì„±í•œ ì´ë¯¸ì§€ë¥¼ ë§¤ìš° í™•ëŒ€í•´ë³´ë©´, original HR imageì™€ ë¹„êµí–ˆì„ ë•Œ texture detailì´ ì¢‹ì§€ ì•ŠìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

</br>

-  <U> ì´ ì›ì¸ì´ ê¸°ì¡´ SR ëª¨ë¸ë“¤ì˜ **loss function**ì— ìˆë‹¤</U>ê³  ë³´ì•˜ë‹¤.

    - ê¸°ì¡´ SR ëª¨ë¸ë“¤ì˜ ëª©í‘œëŠ” ë³´í†µ ë³µêµ¬ëœ HR ì´ë¯¸ì§€ì™€ ì›ë³¸ ì´ë¯¸ì§€ì˜ pixel ê°’ì„ ë¹„êµí•˜ì—¬ pixel-wise MSEë¥¼ ìµœì†Œí™”í•˜ëŠ” ê²ƒ

    - ê·¸ëŸ¬ë‚˜ pixel-wise lossë¥¼ ì‚¬ìš©í•˜ë©´ high texture detailì„ ì œëŒ€ë¡œ ì¡ì•„ë‚´ì§€ ëª»í•˜ëŠ” í•œê³„ê°€ ìˆë‹¤.

- ì €ìë“¤ì€ ì´ì „ ì—°êµ¬ì™€ëŠ” ë‹¤ë¥´ê²Œ VGG networkì˜ high-level feature mapì„ ì´ìš©í•œ **perceptual loss**ë¥¼ ì œì‹œí•˜ì—¬ ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ë‹¤ê³  í•œë‹¤.




</br>
</br>

# 4-2. ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°

![](./img/4-3.png)

## 4-2-1. Generator network, G

- ë˜‘ê°™ì€ layoutì„ ì§€ë‹Œ Bê°œì˜ residual blockìœ¼ë¡œ êµ¬ì„±



### âš™ï¸ Residual blockì˜ êµ¬ì„±

- kernel size: 3 x 3
- kernel ê°œìˆ˜: 64
- stride: 1
- Batch normalization layer
- Activation function: ParametricReLU



</br>

- ì¼ë°˜ì ìœ¼ë¡œ convolution layerë¥¼ ì´ìš©í•˜ë©´ ê·¸ imageì˜ ì°¨ì›ì€ ì‘ì•„ì§€ê±°ë‚˜ ë™ì¼í•˜ê²Œ ìœ ì§€
- super resolutionì„ ìœ„í•´ imageì˜ dimensionì„ ì¦ê°€ì‹œì¼œì•¼ í•¨ ğŸ¤”
- ì—¬ê¸°ì„œ ì´ìš©ëœ ë°©ì‹ì´ **sub-pixel convolution**

</br>

## 4-2-2. Discriminator Network, D

- LeakyReLU($\alpha = 0.2$)ë¥¼ ì‚¬ìš©í–ˆê³ , max-poolingì€ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ë¯€ë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- 3 Ã— 3 kernelì„ ì‚¬ìš©í•˜ëŠ” conv layer 8ê°œë¡œ êµ¬ì„±
- feature mapì˜ ìˆ˜ëŠ” VGG networkì²˜ëŸ¼ 64ë¶€í„° 512ê¹Œì§€ ì»¤ì§.

- ë§ˆì§€ë§‰ feature maps ë’¤ì—ëŠ” dense layer ë‘ ê°œ, ê·¸ë¦¬ê³  classificationì„ ìœ„í•œ sigmoidê°€ ë¶™ëŠ”ë‹¤.


</br>
</br>



# 4-3. Loss function - Perceptual loss ğŸ’¡

- Loss functionìœ¼ë¡œ **Perceptual loss**ë¥¼ ì‚¬ìš©
  - content lossì™€ adversarial lossë¡œ êµ¬ì„±

</br>

- ì´ì¤‘ adversarial lossëŠ” ìš°ë¦¬ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì•Œê³  ìˆëŠ” GANì˜ lossì™€ ë¹„ìŠ·



![](./img/4-5.png)


---

## 4-3-1. Adversarial loss

$$l^{SR}_{Gen} = \sum^N_{n=1} - \log D_{\theta_D} (G_{\theta_G} (I^{LR}))$$

- Generatorê°€ ìƒì„±í•œ ì´ë¯¸ì§€ë¥¼ ì§„ì§œë¼ê³  íŒë‹¨í•  í™•ë¥ ë¡œ ì•ì— - ê°€ ë¶™ì–´ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ìµœì†Œí™”í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ í•™ìŠµ


- ê¸°ì¡´ GAN lossëŠ” $\log (1-x)$ì˜ í˜•íƒœë¡œ ë˜ì–´ì‡ìœ¼ë‚˜ ì´ëŸ¬ë©´ training ì´ˆë°˜ ë¶€ì— í•™ìŠµì´ ëŠë¦¬ë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.

- ì´ë¥¼ $- \log (x)$ í˜•íƒœë¡œ ë°”ê¾¸ì–´ì£¼ë©´ í•™ìŠµ ì†ë„ê°€ í›¨ì”¬ ë¹¨ë¼ì§„ë‹¤ê³  í•¨



</br>

## 4-3-2. Content loss

$$l^{SR}_{VGG/i,j} = \dfrac{1}{W_{i,j} H_{i,j}} \sum^{W_{i,j}}_{x=1} \sum^{H_{i,j}}_{y=1}( \phi_{i,j}((I^{HR})_{x,y})  -  \phi_{i,j}( G_{\theta_G} (I^{LR}) )_{x,y}       )^2$$

- ì‹œê·¸ë§ˆ ì•ˆì— ê°’ = Generatorê°€ ìƒì„±í•œ ì´ë¯¸ì§€ì™€ original HR ì´ë¯¸ì§€ë¡œ ë¶€í„° ì–»ì€ Feature map ì‚¬ì´ì˜ Euclidean distance

---

</br>


- **Per-pixel loss**: Generatorì„ ì´ìš©í•´ ì–»ì–´ë‚¸ ê°€ì§œ ê³ í•´ìƒë„ ì´ë¯¸ì§€ë¥¼ ì§„ì§œ ê³ í•´ìƒë„ ì´ë¯¸ì§€ì™€ Pixel by pixelë¡œ ë¹„êµí•˜ëŠ” ê²ƒ
- **Perceptual loss**: ê° ì´ë¯¸ì§€ë¥¼ pre-trained CNN ëª¨ë¸ì— í†µê³¼ì‹œì¼œ ì–»ì–´ë‚¸ feature mapì„ ë¹„êµí•˜ëŠ” ê²ƒ


</br>
</br>

# ì„±ëŠ¥

![](./img/4-2.png)

- SR GANì´ ìƒì„±í•œ ì´ë¯¸ì§€ë¥¼ ë§¤ìš° í™•ëŒ€í•´ë³´ë©´, SRResNetì´ ë§Œë“  ì´ë¯¸ì§€ì™€ ë¹„êµí–ˆì„ ë•Œ texture detailì´ ì¢‹ì•„ì¡ŒìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

- ë˜í•œ MOS (Mean Opinion score) testingì„ ì§„í–‰í•˜ì˜€ì„ ë•Œ SRGANì˜ ì—„ì²­ë‚œ ì„±ëŠ¥ì„ í™•ì¸
  - MOS (Mean Opinion score) testingì€ 26ëª…ì˜ ì‚¬ëŒì—ì„¸ 1ì (bad) ë¶€í„° 5ì  (excellent)ê¹Œì§€ ì ìˆ˜ë¥¼ ë§¤ê¸°ë„ë¡ í•œ ê²ƒ






![](./img/4-6.png)